# Owner Type Enum for Hyperforge

## Problem

Hyperforge's Codeberg adapter uses the `/orgs/{name}/repos` API endpoint by default, falling back to `/users/{name}/repos` only when the org endpoint returns 404. This causes sync failures when creating repos under user accounts because:

1. The `create_repo` function tries `/org/{name}/repos` first
2. On 404, it falls back to user endpoint
3. But the error message from the failed org call is confusing: `"org does not exist"`

More importantly, there's no way to **configure** whether an account is a user or organization - the adapter guesses at runtime.

## Current Behavior

```
codeberg.rs:117  list_repos  → /orgs/{org}/repos  (fallback to users on 404)
codeberg.rs:174  create_repo → /org/{org}/repos   (fallback to users on 404)
github.rs:118   list_repos  → /orgs/{org}/repos  (fallback to users on 404)
github.rs:175   create_repo → /orgs/{org}/repos  (no fallback - fails)
```

GitHub's `create_repo` has no fallback, causing hard failures.

## Solution

Add an `owner_type` enum field to the organization config.

### Config Change

```yaml
# ~/.config/hyperforge/config.yaml
organizations:
  hypermemetic:
    owner: hypermemetic
    owner_type: user        # NEW: user | org (default: org)
    ssh_key: hypermemetic.proton.me
    origin: codeberg
    forges:
    - github
    - codeberg
```

### Rust Types

```rust
// src/types.rs or src/config/mod.rs

/// Whether the owner is a user account or an organization
#[derive(Debug, Clone, Copy, PartialEq, Eq, Default, Serialize, Deserialize)]
#[serde(rename_all = "lowercase")]
pub enum OwnerType {
    /// Personal user account
    User,
    /// Organization account
    #[default]
    Org,
}
```

### Adapter Changes

The `ForgePort` trait methods should accept `OwnerType`:

```rust
// Option A: Add to method signatures
async fn list_repos(&self, owner: &str, owner_type: OwnerType) -> ForgeResult<Vec<Repo>>;
async fn create_repo(&self, owner: &str, owner_type: OwnerType, repo: &Repo) -> ForgeResult<()>;

// Option B: Store in adapter (cleaner)
pub struct CodebergAdapter {
    client: Client,
    auth: Arc<dyn AuthProvider>,
    api_url: String,
    org: String,
    owner_type: OwnerType,  // NEW
}
```

**Recommendation:** Option B - store in adapter constructor. Cleaner API, adapter already stores `org`.

### Endpoint Selection

```rust
impl CodebergAdapter {
    fn repos_url(&self, owner: &str) -> String {
        match self.owner_type {
            OwnerType::User => format!("{}/users/{}/repos", self.api_url, owner),
            OwnerType::Org => format!("{}/orgs/{}/repos", self.api_url, owner),
        }
    }

    fn create_repo_url(&self, owner: &str) -> String {
        match self.owner_type {
            OwnerType::User => format!("{}/user/repos", self.api_url),  // Note: /user/ not /users/
            OwnerType::Org => format!("{}/org/{}/repos", self.api_url, owner),
        }
    }
}
```

## Files to Modify

| File | Change |
|------|--------|
| `src/types.rs` | Add `OwnerType` enum |
| `src/storage/mod.rs` | Add `owner_type` to org config struct |
| `src/adapters/codeberg.rs` | Use `owner_type` for endpoint selection |
| `src/adapters/github.rs` | Use `owner_type` for endpoint selection |
| `src/adapters/gitlab.rs` | Use `owner_type` for endpoint selection |
| `src/hub.rs` | Pass `owner_type` when constructing adapters |

## API Endpoint Reference

### GitHub
- Org repos: `GET /orgs/{org}/repos`, `POST /orgs/{org}/repos`
- User repos: `GET /users/{username}/repos`, `POST /user/repos`

### Codeberg/Gitea
- Org repos: `GET /orgs/{org}/repos`, `POST /org/{org}/repos`
- User repos: `GET /users/{username}/repos`, `POST /user/repos`

### GitLab
- Group projects: `GET /groups/{id}/projects`, `POST /groups/{id}/projects`
- User projects: `GET /users/{id}/projects`, `POST /projects`

## Migration

Existing configs without `owner_type` default to `org` (current behavior). No breaking changes.

## Testing

```bash
# After implementation:
synapse substrate hyperforge workspace_sync --org hypermemetic --forge codeberg

# Should succeed without "org does not exist" error
```
